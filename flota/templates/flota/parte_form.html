{% extends "base.html" %}

{% block title %}Nuevo parte | Flota{% endblock %}
{% block page_title %}Nuevo parte diario{% endblock %}
{% block page_subtitle %}Cargá lo mínimo (unidad + tipo + descripción). El resto es opcional según el caso.{% endblock %}

{% block content %}
<div class="space-y-4">

  <section class="ti-card p-4">

    <div class="ti-card p-3 mb-3">
      <div class="text-sm font-semibold">Guía rápida</div>
      <ul class="mt-2 text-sm list-disc pl-5 space-y-1">
        <li><span class="font-semibold">Unidad</span>: elegí el interno correcto.</li>
        <li><span class="font-semibold">Tipo</span>: Incidencia / Control / Mantenimiento / Auxilio.</li>
        <li><span class="font-semibold">Descripción</span>: qué pasó + dónde + qué se hizo.</li>
        <li>Si es <span class="font-semibold">Auxilio</span>, cargá inicio/fin. Si es <span class="font-semibold">Mantenimiento</span>, completá el bloque.</li>
      </ul>
      <div class="text-xs ti-subtitle mt-2">Después de guardar, podés adjuntar fotos/boletas y, si corresponde, registrar movimiento de inventario.</div>
    </div>

    <form method="post" class="space-y-3">
      {% csrf_token %}

      {% if form.non_field_errors %}
        <div class="ti-alert ti-alert-error">
          {% for e in form.non_field_errors %}<div>{{ e }}</div>{% endfor %}
        </div>
      {% endif %}

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-3">
        <div>
          <label class="text-xs ti-subtitle">Unidad</label>
          {{ form.colectivo }}
          {% if form.colectivo.errors %}<div class="text-xs text-red-400">{{ form.colectivo.errors }}</div>{% endif %}
        </div>

        <div>
          <label class="text-xs ti-subtitle">Fecha/hora</label>
          {{ form.fecha_evento }}
          {% if form.fecha_evento.errors %}<div class="text-xs text-red-400">{{ form.fecha_evento.errors }}</div>{% endif %}
        </div>

        <div>
          <label class="text-xs ti-subtitle">Odómetro (km)</label>
          {{ form.odometro_km }}
          {% if form.odometro_km.errors %}<div class="text-xs text-red-400">{{ form.odometro_km.errors }}</div>{% endif %}
        </div>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-3">
        <div>
          <label class="text-xs ti-subtitle">Tipo</label>
          {{ form.tipo }}
          {% if form.tipo.errors %}<div class="text-xs text-red-400">{{ form.tipo.errors }}</div>{% endif %}
        </div>
        <div>
          <label class="text-xs ti-subtitle">Severidad</label>
          {{ form.severidad }}
          {% if form.severidad.errors %}<div class="text-xs text-red-400">{{ form.severidad.errors }}</div>{% endif %}
        </div>
        <div>
          <label class="text-xs ti-subtitle">Estado</label>
          {{ form.estado }}
          {% if form.estado.errors %}<div class="text-xs text-red-400">{{ form.estado.errors }}</div>{% endif %}
        </div>
      </div>

      <div class="ti-card p-3">
        <div class="text-sm font-semibold">Mantenimiento (solo si Tipo = Mantenimiento)</div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-3 mt-2">
          <div>
            <label class="text-xs ti-subtitle">Acción</label>
            {{ form.accion_mantenimiento }}
            {% if form.accion_mantenimiento.errors %}<div class="text-xs text-red-400">{{ form.accion_mantenimiento.errors }}</div>{% endif %}
          </div>
          <div>
            <label class="text-xs ti-subtitle">Km del cambio</label>
            {{ form.km_mantenimiento }}
            {% if form.km_mantenimiento.errors %}<div class="text-xs text-red-400">{{ form.km_mantenimiento.errors }}</div>{% endif %}
          </div>
          <div>
            <label class="text-xs ti-subtitle">Matafuego vto (opcional)</label>
            {{ form.matafuego_vto_nuevo }}
            {% if form.matafuego_vto_nuevo.errors %}<div class="text-xs text-red-400">{{ form.matafuego_vto_nuevo.errors }}</div>{% endif %}
          </div>
        </div>
      </div>

      <div class="ti-card p-3">
        <div class="text-sm font-semibold">Auxilio (solo si Tipo = Auxilio)</div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 mt-2">
          <div>
            <label class="text-xs ti-subtitle">Inicio</label>
            {{ form.auxilio_inicio }}
          </div>
          <div>
            <label class="text-xs ti-subtitle">Fin</label>
            {{ form.auxilio_fin }}
            {% if form.auxilio_fin.errors %}<div class="text-xs text-red-400">{{ form.auxilio_fin.errors }}</div>{% endif %}
          </div>
        </div>
      </div>

      <div>
        <label class="text-xs ti-subtitle">Descripción</label>
        {{ form.descripcion }}
        {% if form.descripcion.errors %}<div class="text-xs text-red-400">{{ form.descripcion.errors }}</div>{% endif %}
      </div>

      <div>
        <label class="text-xs ti-subtitle">Observaciones</label>
        {{ form.observaciones }}
      </div>

      <input type="hidden" name="next" value="{{ request.GET.next|default:'' }}">

      <div class="flex flex-col sm:flex-row gap-2">
        <button class="ti-btn-primary w-full sm:w-auto" type="submit">Guardar</button>
        {% with cancel_url=request.GET.next|default:'' %}
          {% if cancel_url %}
            <a class="ti-btn w-full sm:w-auto text-center" href="{{ cancel_url }}">Cancelar</a>
          {% else %}
            <a class="ti-btn w-full sm:w-auto text-center" href="{% url 'flota:parte_list' %}">Cancelar</a>
          {% endif %}
        {% endwith %}
      </div>

    </form>
  </section>

</div>
{% endblock %}