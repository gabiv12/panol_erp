{% extends "base.html" %}
{% load static %}

{% block title %}{% if modo == 'editar' %}Editar usuario{% else %}Nuevo usuario{% endif %} | Pañol ERP{% endblock %}
{% block page_title %}Administración{% endblock %}
{% block page_subtitle %}Usuarios y roles (base).{% endblock %}

{% block content %}

<section class="ti-card p-4">
  <div class="flex items-start justify-between gap-3">
    <div>
      <div class="text-sm font-semibold">
        {% if modo == 'editar' %}
          Editar usuario
        {% else %}
          Nuevo usuario
        {% endif %}
      </div>
      <div class="text-xs ti-subtitle">
        {% if modo == 'editar' %}
          Usuario: <span class="font-semibold">{{ obj.username }}</span>
        {% else %}
          Creá un usuario para operar el sistema.
        {% endif %}
      </div>
    </div>

    <div class="flex flex-wrap gap-2">
      <a href="{% url 'usuarios:usuario_list' %}" class="ti-btn">Volver</a>
    </div>
  </div>

  <form method="post" class="mt-4 space-y-4" novalidate>
    {% csrf_token %}

    {% if form.non_field_errors %}
      <div class="ti-card p-3 border border-rose-200 bg-rose-50 text-rose-700 dark:border-rose-900/60 dark:bg-rose-950/40 dark:text-rose-200">
        <div class="text-sm font-semibold">Revisá el formulario</div>
        <div class="text-xs mt-1">{{ form.non_field_errors|striptags }}</div>
      </div>
    {% endif %}

    
    <div class="ti-card p-4">
      <div class="text-sm font-semibold">Rol</div>
      <div class="text-xs ti-subtitle">Define qué módulos ve el usuario (menú y permisos).</div>
      <div class="mt-3">
        <label class="ti-label" for="{{ form.role.id_for_label }}">{{ form.role.label }}</label>
        {{ form.role }}
        {% if form.role.errors %}<div class="ti-error">{{ form.role.errors|striptags }}</div>{% endif %}
      </div>
    </div>

<div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div>
        <label class="ti-label" for="{{ form.username.id_for_label }}">Usuario</label>
        {{ form.username }}
        {% if form.username.errors %}<div class="ti-error">{{ form.username.errors|striptags }}</div>{% endif %}
      </div>

      <div>
        <label class="ti-label" for="{{ form.email.id_for_label }}">Email</label>
        {{ form.email }}
        {% if form.email.errors %}<div class="ti-error">{{ form.email.errors|striptags }}</div>{% endif %}
      </div>

      <div>
        <label class="ti-label" for="{{ form.first_name.id_for_label }}">Nombre</label>
        {{ form.first_name }}
        {% if form.first_name.errors %}<div class="ti-error">{{ form.first_name.errors|striptags }}</div>{% endif %}
      </div>

      <div>
        <label class="ti-label" for="{{ form.last_name.id_for_label }}">Apellido</label>
        {{ form.last_name }}
        {% if form.last_name.errors %}<div class="ti-error">{{ form.last_name.errors|striptags }}</div>{% endif %}
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
      <div class="ti-card p-3">
        <div class="flex items-center gap-2">
          {{ form.is_active }}
          <label for="{{ form.is_active.id_for_label }}" class="text-sm font-semibold">Activo</label>
        </div>
        <div class="text-xs ti-subtitle mt-1">Si está inactivo, no podrá iniciar sesión.</div>
        {% if form.is_active.errors %}<div class="ti-error">{{ form.is_active.errors|striptags }}</div>{% endif %}
      </div>

      <div class="ti-card p-3">
        <div class="flex items-center gap-2">
          {{ form.is_staff }}
          <label for="{{ form.is_staff.id_for_label }}" class="text-sm font-semibold">Staff</label>
        </div>
        <div class="text-xs ti-subtitle mt-1">Permite acceder a paneles internos (no es superusuario).</div>
        {% if form.is_staff.errors %}<div class="ti-error">{{ form.is_staff.errors|striptags }}</div>{% endif %}
      </div>
    </div>

    <div class="ti-card p-4">
      <div class="text-sm font-semibold">Contraseña</div>
      <div class="text-xs ti-subtitle">
        {% if modo == 'editar' %}
          Solo completá estos campos si querés cambiar la contraseña.
        {% else %}
          Definí la contraseña inicial del usuario.
        {% endif %}
      </div>

      <div class="mt-3 grid grid-cols-1 md:grid-cols-2 gap-3">
        <div>
          <label class="ti-label" for="{{ form.password1.id_for_label }}">{{ form.password1.label }}</label>
          <div class="relative">
            {{ form.password1 }}
            <button type="button" class="ti-btn absolute right-2 top-1/2 -translate-y-1/2" data-toggle-password data-target="#{{ form.password1.auto_id }}">Mostrar</button>
          </div>
          {% if form.password1.errors %}<div class="ti-error">{{ form.password1.errors|striptags }}</div>{% endif %}
        </div>

        <div>
          <label class="ti-label" for="{{ form.password2.id_for_label }}">{{ form.password2.label }}</label>
          <div class="relative">
            {{ form.password2 }}
            <button type="button" class="ti-btn absolute right-2 top-1/2 -translate-y-1/2" data-toggle-password data-target="#{{ form.password2.auto_id }}">Mostrar</button>
          </div>
          {% if form.password2.errors %}<div class="ti-error">{{ form.password2.errors|striptags }}</div>{% endif %}
        </div>
      </div>
    </div>

    <div class="flex flex-wrap gap-2 pt-2">
      <button type="submit" class="ti-btn-primary">
        {% if modo == 'editar' %}Guardar cambios{% else %}Crear usuario{% endif %}
      </button>
      <a href="{% url 'usuarios:usuario_list' %}" class="ti-btn">Cancelar</a>
    </div>

  </form>
</section>

{% endblock %}
